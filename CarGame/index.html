<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ultimate Car Racer - Pro Version</title>
    <style>
        /* --- CSS STYLING --- */
        @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Press Start 2P', cursive; }
        
        body { overflow: hidden; background-color: #2c3e50; }

        .hide { display: none; }

        /* Game Screen */
        .gameArea {
            width: 400px;
            height: 100vh;
            background-color: #2d3436;
            margin: auto;
            position: relative;
            overflow: hidden;
            border-left: 7px dashed #c8d6e5;
            border-right: 7px dashed #c8d6e5;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
        }

        /* Road Lines */
        .lines {
            width: 10px;
            height: 100px;
            background: white;
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
        }

        /* Player Car */
        .car {
            position: absolute;
            bottom: 120px;
            left: calc(50% - 25px);
            width: 50px;
            height: 90px;
            background: linear-gradient(to bottom, #e84118, #c23616);
            border-radius: 10px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.3);
            z-index: 10;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 30px;
            transition: transform 0.1s;
        }

        /* Blast Effect (Collision) */
        .car.blast {
            background: url('https://i.imgur.com/P3Kn7g4.gif') no-repeat center center; /* Simple explosion gif or css effect */
            background-size: contain;
            background-color: transparent; 
            border: none;
            box-shadow: none;
            transform: scale(2);
        }

        /* Enemy Car */
        .enemy {
            position: absolute;
            width: 50px;
            height: 90px;
            border-radius: 10px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.3);
            z-index: 9;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 30px;
        }

        /* Fuel Can */
        .fuelCan {
            position: absolute;
            width: 40px;
            height: 40px;
            background: #e74c3c;
            border: 2px solid white;
            border-radius: 5px;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            font-size: 20px;
            box-shadow: 0 0 15px #e74c3c;
            z-index: 8;
        }

        /* HUD: Score & High Score */
        .scoreSpace, .highScoreSpace {
            position: absolute;
            left: 20px;
            font-size: 15px;
            color: white;
            background-color: rgba(0,0,0,0.6);
            padding: 10px;
            border-radius: 5px;
            border-left: 5px solid #feca57;
            z-index: 15;
        }
        .scoreSpace { top: 20px; }
        .highScoreSpace { top: 60px; border-left: 5px solid #54a0ff; }

        /* HUD: Fuel Bar */
        .fuelBarBox {
            position: absolute;
            top: 110px;
            left: 20px;
            width: 180px;
            height: 25px;
            background: white;
            border: 3px solid #333;
            border-radius: 15px;
            overflow: hidden;
            z-index: 15;
        }
        .fuelBar {
            width: 100%;
            height: 100%;
            background: linear-gradient(to right, #e74c3c, #f1c40f, #2ecc71);
            transition: width 0.1s linear;
        }
        .fuelText {
            position: absolute;
            top: 115px;
            left: 210px;
            color: white;
            font-size: 12px;
            z-index: 15;
        }

        /* Start Modal */
        .startScreen {
            position: absolute;
            background-color: #ee5253;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            color: white;
            z-index: 20;
            text-align: center;
            border: 4px solid #fff;
            padding: 20px;
            width: 320px;
            cursor: pointer;
            box-shadow: 0 10px 30px rgba(0,0,0,0.8);
            border-radius: 10px;
            line-height: 1.5;
        }

        /* Mobile Controls */
        .controls {
            position: absolute;
            bottom: 30px;
            width: 100%;
            display: flex;
            justify-content: space-between;
            padding: 0 20px;
            z-index: 100;
        }
        
        .btn {
            width: 80px;
            height: 80px;
            background: rgba(255,255,255,0.1);
            border-radius: 50%;
            border: 2px solid rgba(255,255,255,0.5);
            color: white;
            font-size: 30px;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            user-select: none;
            backdrop-filter: blur(5px);
        }
        .btn:active { background: rgba(255,255,255,0.4); transform: scale(0.95); }

    </style>
</head>
<body>

    <div class="scoreSpace">Score: 0</div>
    <div class="highScoreSpace">Best: 0</div>
    
    <div class="fuelBarBox">
        <div class="fuelBar"></div>
    </div>
    <div class="fuelText">FUEL</div>

    <div class="startScreen">
        <p>
            <b>üî• PRO CAR RACER üî•</b><br><br>
            Tap here to Start<br><br>
            üõë Avoid Cars<br>
            ‚õΩ Collect Fuel<br><br>
            <i>Best Score saved automatically!</i>
        </p>
    </div>

    <div class="gameArea"></div>

    <div class="controls">
        <div class="btn" id="leftBtn">‚Üê</div>
        <div class="btn" id="rightBtn">‚Üí</div>
    </div>

    <script>
        /* --- JAVASCRIPT LOGIC --- */

        const scoreArea = document.querySelector('.scoreSpace');
        const highScoreArea = document.querySelector('.highScoreSpace');
        const startScreen = document.querySelector('.startScreen');
        const gameArea = document.querySelector('.gameArea');
        const fuelBar = document.querySelector('.fuelBar');

        // Audio Context setup (Synthesizer - No external files needed!)
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        
        function playSound(type) {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const osc = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            osc.connect(gainNode);
            gainNode.connect(audioCtx.destination);

            if (type === 'crash') {
                osc.type = 'sawtooth';
                osc.frequency.value = 100;
                osc.frequency.exponentialRampToValueAtTime(10, audioCtx.currentTime + 0.5);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.5);
                osc.start();
                osc.stop(audioCtx.currentTime + 0.5);
            } else if (type === 'fuel') {
                osc.type = 'sine';
                osc.frequency.value = 800;
                osc.frequency.exponentialRampToValueAtTime(1200, audioCtx.currentTime + 0.1);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.1);
                osc.start();
                osc.stop(audioCtx.currentTime + 0.1);
            }
        }

        // Game Variables
        let player = { speed: 5, score: 0 };
        let fuel = 100;
        let keys = { ArrowUp: false, ArrowDown: false, ArrowLeft: false, ArrowRight: false };
        
        // Load High Score from LocalStorage
        let highScore = localStorage.getItem('highScore') || 0;
        highScoreArea.innerHTML = "Best: " + highScore;

        // Controls (Keyboard & Touch)
        document.addEventListener('keydown', (e)=>{ e.preventDefault(); keys[e.key] = true; });
        document.addEventListener('keyup', (e)=>{ e.preventDefault(); keys[e.key] = false; });
        
        const bindTouch = (btn, key) => {
            btn.addEventListener('touchstart', (e) => { e.preventDefault(); keys[key] = true; });
            btn.addEventListener('touchend', (e) => { e.preventDefault(); keys[key] = false; });
            btn.addEventListener('mousedown', () => keys[key] = true);
            btn.addEventListener('mouseup', () => keys[key] = false);
        }
        bindTouch(document.getElementById('leftBtn'), 'ArrowLeft');
        bindTouch(document.getElementById('rightBtn'), 'ArrowRight');

        startScreen.addEventListener('click', start);

        function isCollide(a, b) {
            aRect = a.getBoundingClientRect();
            bRect = b.getBoundingClientRect();
            return !((aRect.bottom < bRect.top) || (aRect.top > bRect.bottom) || 
                     (aRect.right < bRect.left) || (aRect.left > bRect.right));
        }

        function moveLines() {
            let lines = document.querySelectorAll('.lines');
            lines.forEach(function(item) {
                if (item.y >= 700) item.y -= 750;
                item.y += player.speed;
                item.style.top = item.y + "px";
            });
        }

        function endGame(reason) {
            player.start = false;
            playSound('crash');
            
            // Blast Effect
            let car = document.querySelector('.car');
            car.classList.add('blast');
            car.innerHTML = "üí•";

            // Update High Score
            if(player.score > highScore) {
                highScore = player.score;
                localStorage.setItem('highScore', highScore);
                highScoreArea.innerHTML = "Best: " + highScore;
            }

            setTimeout(() => {
                startScreen.classList.remove('hide');
                startScreen.innerHTML = `
                    <b>GAME OVER</b><br>
                    Reason: ${reason}<br><br>
                    Score: ${player.score}<br>
                    Best: ${highScore}<br><br>
                    Tap to Restart
                `;
            }, 1000);
        }

        function moveEnemy(car) {
            let enemy = document.querySelectorAll('.enemy');
            enemy.forEach(function(item) {
                if (isCollide(car, item)) {
                    endGame("Car Crashed!");
                }
                if (item.y >= 750) {
                    item.y = -300;
                    item.style.left = Math.floor(Math.random() * 350) + "px";
                    item.style.backgroundColor = randomColor();
                }
                item.y += player.speed;
                item.style.top = item.y + "px";
            });
        }

        function moveFuel(car) {
            let fuelCan = document.querySelector('.fuelCan');
            
            // Collision Logic
            if(isCollide(car, fuelCan)){
                playSound('fuel');
                fuel = 100; // Refill
                fuelCan.y = -600; // Reset position
                fuelCan.style.left = Math.floor(Math.random() * 350) + "px";
            }

            // Movement
            if (fuelCan.y >= 750) {
                fuelCan.y = -400; // Respawn delay
                fuelCan.style.left = Math.floor(Math.random() * 350) + "px";
            }
            fuelCan.y += player.speed; // Move same speed as road
            fuelCan.style.top = fuelCan.y + "px";
        }

        function randomColor(){
            function c(){ let hex = Math.floor(Math.random()*256).toString(16); return ("0"+ String(hex)).substr(-2); }
            return "#"+c()+c()+c();
        }

        function gamePlay() {
            let car = document.querySelector('.car');
            let road = gameArea.getBoundingClientRect();

            if (player.start) {
                moveLines();
                moveEnemy(car);
                moveFuel(car);

                // Movement Logic
                if (keys.ArrowUp && player.y > (road.top + 70)) player.y -= player.speed;
                if (keys.ArrowDown && player.y < (road.bottom - 85)) player.y += player.speed;
                if (keys.ArrowLeft && player.x > 0) player.x -= player.speed;
                if (keys.ArrowRight && player.x < (road.width - 50)) player.x += player.speed;

                car.style.top = player.y + "px";
                car.style.left = player.x + "px";

                window.requestAnimationFrame(gamePlay);

                // Update Score
                player.score++;
                scoreArea.innerText = "Score: " + player.score;

                // Decrease Fuel
                fuel -= 0.12; // Fuel consumption rate
                if(fuel < 0) fuel = 0;
                fuelBar.style.width = fuel + "%";
                
                // Color change based on fuel level
                if(fuel > 60) fuelBar.style.background = "#2ecc71";
                else if(fuel > 30) fuelBar.style.background = "#f1c40f";
                else fuelBar.style.background = "#e74c3c";

                if(fuel <= 0) {
                    endGame("Out of Fuel!");
                }

                // Increase Difficulty
                if(player.score % 500 === 0) player.speed++;
            }
        }

        function start() {
            // Reset Audio Context
            if (audioCtx.state === 'suspended') audioCtx.resume();

            startScreen.classList.add('hide');
            gameArea.innerHTML = "";

            player.start = true;
            player.score = 0;
            player.speed = 5;
            fuel = 100;
            
            // Create Road Lines
            for (x = 0; x < 5; x++) {
                let roadLine = document.createElement('div');
                roadLine.setAttribute('class', 'lines');
                roadLine.y = (x * 150);
                roadLine.style.top = roadLine.y + "px";
                gameArea.appendChild(roadLine);
            }

            // Create Player Car
            let car = document.createElement('div');
            car.setAttribute('class', 'car');
            car.innerHTML = "üèéÔ∏è"; 
            gameArea.appendChild(car);

            player.x = car.offsetLeft;
            player.y = car.offsetTop;

            // Create Fuel Can
            let fuelCan = document.createElement('div');
            fuelCan.setAttribute('class', 'fuelCan');
            fuelCan.innerHTML = "‚õΩ";
            fuelCan.y = -300; // Start off screen
            gameArea.appendChild(fuelCan);

            // Create Enemy Cars
            for (x = 0; x < 3; x++) {
                let enemyCar = document.createElement('div');
                enemyCar.setAttribute('class', 'enemy');
                enemyCar.y = ((x + 1) * 350) * -1;
                enemyCar.style.top = enemyCar.y + "px";
                enemyCar.style.left = Math.floor(Math.random() * 350) + "px";
                enemyCar.style.backgroundColor = randomColor();
                enemyCar.innerHTML = "üöó";
                gameArea.appendChild(enemyCar);
            }

            window.requestAnimationFrame(gamePlay);
        }
    </script>
</body>
</html>